var visualize=function(e,t,a,l){var i=t.qInfo.qId+"_chartjs_stacked_bar",o=l.calculateMargin(e,t),n=o[0],s=o[1];e.html('<canvas id="'+i+'" width="'+n+'" height="'+s+'"></canvas>');var r=l.defineColorPalette(t.color_selection),c=t.qHyperCube.qDataPages[0].qMatrix,d=l.flattenData(c),u=d[0],b=d[1],m=d[2];t.sort&&b.sort();var p=_.groupBy(u,"dim1"),h=[];h.dim1=[],h.dim1_elem=[],h=l.initializeArrayWithZero(_.size(p),b,h),h=l.storeHypercubeDataToArray(p,h),t.cumulative&&(h=l.addCumulativeValuesOnTwoDimensions(b,h));for(var v=[],g=0;g<b.length;g++){var y=[],f=g;"twelve"==t.color_selection?f=g%12:"one-handred"==t.color_selection&&(f=g%100),y.label=b[g],y.backgroundColor="rgba("+r[f]+","+t.opacity+")",y.data=h[b[g]],y.fill=t.background_color_switch,y.borderColor="rgba("+r[f]+","+t.opacity+")",y.pointBackgroundColor="#FFFFFF",y.pointRadius=t.point_radius_size,v.push(y)}var k={labels:h.dim1,datasets:v},q=document.getElementById(i);new Chart(q,{type:"line",data:k,options:{title:{display:t.title_switch,text:t.title},legend:{display:"hide"!=t.legend_position,position:t.legend_position,onClick:function(e,t){var l=[],i=1;m[t.text]<0||(l.push(m[t.text]),a.selectValues(i,l,!0))}},scales:{xAxes:[{scaleLabel:{display:t.datalabel_switch,labelString:t.qHyperCube.qDimensionInfo[0].qFallbackTitle}}],yAxes:[{scaleLabel:{display:t.datalabel_switch,labelString:t.qHyperCube.qMeasureInfo[0].qFallbackTitle},ticks:{beginAtZero:!0,callback:function(e,a,i){return l.formatMeasure(e,t,0)}}}]},tooltips:{mode:"label",callbacks:{label:function(e,a){return a.datasets[e.datasetIndex].label+": "+l.formatMeasure(e.yLabel,t,0)}}},responsive:!0,events:["mousemove","mouseout","click","touchstart","touchmove","touchend"],onClick:function(e){var t=this.getElementsAtEvent(e);t.length>0&&l.makeSelectionsOnDataPoints(h.dim1_elem[t[0]._index],a)}}})};